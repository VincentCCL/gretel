!function(t){function e(e){errorContainer=t(".tv-error"),V=e.fsFontSizes,T=e.initFSOnClick;var i=[],n=[];if(e.normalView){x=!0,t(e.container).append('<div id="tree-visualizer" style="display: none"></div>'),h=t("#tree-visualizer");var o='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+e.fontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside>';e.fsView&&(o+='<button class="tv-show-fs">Fullscreen</button>'),h.append(o),m=h.find(".tree"),w=h.find(".tooltip"),i.push("#tree-visualizer .tree"),n.push("#tree-visualizer .tooltip")}if(e.fsView){C=!0,t("body").append('<div id="tree-visualizer-fs" style="display: none"></div>'),c=t("#tree-visualizer-fs");var a='<div class="tv-error" style="display: none"><p></p></div><div class="tree"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside><div class="zoom-opts"><button class="zoom-out">-</button><button class="zoom-default">Default</button><button class="zoom-in">+</button><button class="close">&#10005;</button></div>';c.hide().append(a),v=c.find(".tree"),b=c.find(".tooltip"),z=c.find(".zoom-opts"),f=Math.round(V.length/2),i.push("#tree-visualizer-fs .tree"),n.push("#tree-visualizer-fs .tooltip")}advanced=e.advanced,""!=e.fsBtn&&t(e.fsBtn).addClass("tv-show-fs"),g=t(i.join()),y=t(n.join())}function i(e){t.ajax({type:"GET",url:e,dataType:"xml"}).done(function(t){null==t?p("Your XML appears to be empty or not in a compatible format."):n(t)}).fail(function(t){var e="";e=0===t.status?"Not connect.\n Verify Network.":404==t.status?"Requested page not found. [404]":500==t.status?"Internal Server Error [500].":"parsererror"===exception?"Requested parse failed.":"timeout"===exception?"Time out error.":"abort"===exception?"Ajax request aborted.":"Uncaught Error.\n"+t.responseText,p(e)})}function n(e){var i=t(e);u(),g.html(o(i.find("node").first())),y.children("ul").empty(),a()}function o(e){var i=t("<ol/>");return e.each(function(e,n){for(var a=t('<li><a href="#"></a></li>'),s=0,r=n.attributes.length,d=null;r>s;s++)d=n.attributes[s],a.attr("data-"+d.nodeName,d.value.replace(/^\s(.+)/g,"$1"));t(this).children("node").length&&a.append(o(t(this).children("node"))),i.append(a)}),i}function a(){g.find("a").each(function(){var e=t(this),i=e.parent("li");i.data("rel")&&(e.append("<span>"+i.data("rel")+"<span>"),i.data("index")&&e.append("<span>"+i.data("index")+"</span>")),i.data("pt")?i.data("index")?e.children("span:last-child").append(":"+i.data("pt")):e.append("<span>"+i.data("pt")+"</span>"):i.data("cat")&&(i.data("index")?e.children("span:last-child").append(":"+i.data("cat")):e.append("<span>"+i.data("cat")+"</span>")),e.is(":only-child")&&(i.data("lemma")&&i.append("<span>"+i.data("lemma")+"</span>"),i.data("word")&&i.append("<span><em>"+i.data("word")+"</em></span>")),e.addClass("only-child")}),g.find("li:only-child").addClass("only-child"),g.find("li:first-child").addClass("first-child"),g.find("li:last-child").addClass("last-child"),x&&h.show()}function s(){f>=V.length-1?z.find("button.zoom-in").prop("disabled",!0):0>=f?z.find("button.zoom-out").prop("disabled",!0):z.find("button").prop("disabled",!1)}function r(){v.css("fontSize",V[f]+"px")}function d(){var e;"undefined"!=typeof v&&v.is(":visible")?e=v:"undefined"!=typeof m&&m.is(":visible")&&(e=m);var i=e.find("a.hovered");if(i.length){var n=e.next(".tooltip"),o=i.offset(),a=e.offset(),s=t(window),r={top:o.top,right:s.outerWidth()-(o.left+i.outerWidth()),bottom:s.outerHeight()-(o.top+i.outerHeight()),left:o.left,w:i.outerWidth(),h:i.outerHeight()},d={top:a.top,right:s.outerWidth()-(a.left+e.outerWidth()),bottom:s.outerHeight()-(a.top+e.outerHeight()),left:a.left,w:e.outerWidth(),h:e.outerHeight()};n.css({left:parseInt(r.left+r.w/2-n.outerWidth()/2+7.5,10),top:parseInt(r.top-n.outerHeight()-24,10)-s.scrollTop()}),console.log(s.scrollTop()),r.left+r.w/2<d.left||r.right+r.w/2<d.right||r.top+r.h/2<d.top||r.bottom+r.h<d.bottom?n.fadeOut(400):n.show()}}function l(){var e=parseInt(v.css("paddingRight"),10)||0,i=parseInt(v.css("paddingTop"),10)||0,n=parseInt(c.css("paddingRight"),10)||0,o=parseInt(c.css("paddingTop"),10)||0,a=v.children("ol"),s=t(window);v.css({width:a.outerWidth()+2*e,height:a.outerHeight()+2*i,"max-width":s.width()-2*n,"max-height":s.height()-2*o}),v.css({"margin-left":(s.width()-2*n-v.outerWidth())/2,"margin-top":(s.height()-2*o-v.outerHeight())/2})}function p(t){errorContainer.children("p").text(t).parent().fadeIn(250),x&&(m.scrollLeft(0),h.find(".tv-show-fs").prop("disabled",!0))}function u(){errorContainer.hide(),x&&h.find(".tv-show-fs").prop("disabled",!1)}var f,c,h,v,m,b,w,g,y,z,x,C,V,T;t.treeVisualizer=function(n,o){var a=t.extend({},t.treeVisualizer.defaults,o);a.normalView||a.fsView?(e(a),i(n)):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense."),t(document).ready(function(){T?(c.fadeIn(),s(),r(),setTimeout(function(){l()},10)):t(".tv-show-fs").click(function(t){y.css("top","-100%").children("ul").empty(),"undefined"!=typeof m&&m.find("a").removeClass("hovered"),s(),r(),c.show(),l(),t.preventDefault()}),g.scroll(function(){d()}),t(window).scroll(function(){d()}),z.find("button").click(function(){var e=t(this);e.is(".close")?c.fadeOut(250,function(){v.find("a").removeClass("hovered")}):(e.is(".zoom-in")?f++:e.is(".zoom-out")?f--:e.is(".zoom-default")&&(f=Math.round(V.length/2)),s(),r(),l(),d())}),C&&t(window).on("resize",l),g.on("click","a",function(e){var i=t(this),n=i.parent("li"),o=n.data(),a=i.closest(".tree"),s=a.find("a"),r=a.next(".tooltip").children("ul");r.empty(),s.removeClass("hovered"),i.addClass("hovered");var l;for(l in o)o.hasOwnProperty(l)&&t("<li>",{html:"<strong>"+l+"</strong>: "+o[l]}).prependTo(r);d(),e.preventDefault()}),y.find("button").click(function(){var e=t(this),i=e.parent(".tooltip"),n=i.prev(".tree"),o=n.find("a");i.fadeOut(250),o.removeClass("hovered")})})},t.treeVisualizer.defaults={normalView:!0,fsView:!0,fontSize:12,fsBtn:"",fsFontSizes:[8,10,12,14,16,20],initFSOnClick:!1,container:"body"}}(jQuery);
